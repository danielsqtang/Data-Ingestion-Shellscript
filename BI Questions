from pyspark.sql import HiveContext
hive_context = HiveContext(sc)
Orders = hive_context.table("NorthwindOrders")
OrderDetails = hive_context.table("NorthwindOrderDetails")
Customers = hive_context.table("NorthwindCustomers")
Products = hive_context.table("NorthwindProducts")
Flattened = hive_context.table("NorthwindFlattened")

  1.Which country has the most customers? Which city has the most customers?
singular = Customers.filter(Customers['country'] != null)

  2.Which country has the most orders? Which city has the most orders?
  3.What are the top ten products in revenue for 1997? 
orders1997 = Flattened.filter(pyspark.sql.functions.col("OrderDate").between('1997-01-01 00:00:00', '1997-12-30 00:00:00'))
FlattenedWithRev = Flattened.withColumn("TotalRev", Flattened.quantity*Flattened.unitprice)
totalrevenue = details1.groupBy().sum('TotalRev')
totalrevenue.collect()
  4.Which product is the most expensive? How much revenue has this product generated in the 1997 year?
mostExpensive = Flattened.agg({"unitprice": "max"})
mostExpensive.collect()
263
orders1997WithRev = FlattenedWithRev.filter(pyspark.sql.functions.col("OrderDate").between('1997-01-01 00:00:00', '1997-12-30 00:00:00'))

mostExpensive1997 = orders1997WithRev.filter("unitprice=263")
mostExpensive1997Rev = mostExpensive1997.groupBy().sum('TotalRev')
mostExpensive1997Rev.collect()


  5.How many products are available to purchase at this time? Which products are the least purchased?
  6.How many products are no longer available to puchase at this time?
  7.What shipping company provides the most shipping service to us in 1997?
  8.What is the longest time after ordering an item to receive it? Shortest? 
  9.What are the most popular products by country?
  10.What product category is most popular? 
  11.What product category is most popular by country?
  12.What is the average delivery time for a product?
  13.Who are the employees that process most orders? 
